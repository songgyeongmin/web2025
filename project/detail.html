<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ìƒì„¸ ì •ë³´</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f9f9f9;
    }
    .info, #description, #news, #memoBox {
      max-width: 700px;
      margin: 30px auto;
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    #chartContainer {
      max-width: 700px;
      margin: 0 auto 30px;
    }
    h1 {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 12px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    h1 img {
      width: 32px;
      height: 32px;
      border-radius: 6px;
    }
    .btn-link {
      display: inline-block;
      margin-left: 10px;
      padding: 6px 12px;
      background-color: #007bff;
      color: white;
      border-radius: 6px;
      text-decoration: none;
      font-size: 14px;
      cursor: pointer;
    }
    .btn-link:hover {
      background-color: #0056b3;
    }
    ul {
      padding-left: 20px;
    }
    li {
      margin-bottom: 10px;
    }
    a {
      color: #007bff;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
    #memoTextarea {
      width: 100%;
      height: 80px;
      padding: 8px;
      font-size: 14px;
      box-sizing: border-box;
    }
    #saveMemoBtn {
      margin-top: 10px;
      padding: 6px 12px;
      font-size: 14px;
      background-color: #28a745;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    #saveMemoBtn:hover {
      background-color: #218838;
    }
  </style>
</head>
<body>
  <h1 id="stockTitle">ìƒì„¸ ì •ë³´</h1>

  <div class="info">
    <div>í˜„ì¬ê°€: <span id="currentPrice">ë¡œë”© ì¤‘...</span></div>
    <div>ì „ì¼ ì¢…ê°€: <span id="prevClose">-</span></div>
  </div>

  <div id="chartContainer">
    <canvas id="stockChart" height="100"></canvas>
  </div>

  <div id="memoBox" style="display: none;">
    <h3>ğŸ““ ë©”ëª¨</h3>
    <textarea id="memoTextarea" placeholder="ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
    <button id="saveMemoBtn">ğŸ’¾ ì €ì¥</button>
    <span id="memoSaved" style="margin-left:10px; color:green; display:none;">âœ… ì €ì¥ë¨</span>
  </div>

  <div id="description">
    <h3>íšŒì‚¬ ì„¤ëª… <a href="#" id="wikiLink" target="_blank" style="font-size:14px;">ğŸ”— ìœ„í‚¤ë°±ê³¼</a></h3>
    <p id="wikiSummary">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
  </div>

  <div id="news">
    <h3>ê´€ë ¨ ë‰´ìŠ¤</h3>
    <ul id="newsList">ë¡œë”© ì¤‘...</ul>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const TWELVE_API_KEY = "1a4a7a2f69ba42c0bc6edb908ee842aa";
    const params = new URLSearchParams(window.location.search);
    const symbol = params.get("symbol");

    const companyInfo = {
      AAPL: { name: "Apple", logo: "https://logo.clearbit.com/apple.com", youtube: "https://www.youtube.com/@Apple" },
      MSFT: { name: "Microsoft", logo: "https://logo.clearbit.com/microsoft.com", youtube: "https://www.youtube.com/@Microsoft" },
      NVDA: { name: "NVIDIA", logo: "https://logo.clearbit.com/nvidia.com", youtube: "https://www.youtube.com/@NVIDIA" },
      GOOGL: { name: "Alphabet", logo: "https://logo.clearbit.com/abc.xyz", youtube: "https://www.youtube.com/@Google" },
      AMZN: { name: "Amazon", logo: "https://logo.clearbit.com/amazon.com", youtube: "https://www.youtube.com/@AmazonNews" },
      META: { name: "Meta", logo: "https://logo.clearbit.com/meta.com", youtube: "https://www.youtube.com/@Meta" },
      TSLA: { name: "Tesla", logo: "https://logo.clearbit.com/tesla.com", youtube: "https://www.youtube.com/@Tesla" },
      AVGO: { name: "Broadcom", logo: "https://logo.clearbit.com/broadcom.com", youtube: "https://www.youtube.com/@BroadcomInc" },
      COST: { name: "Costco", logo: "https://logo.clearbit.com/costco.com", youtube: "https://www.youtube.com/@Costco" },
      ASML: { name: "ASML", logo: "https://logo.clearbit.com/asml.com", youtube: "https://www.youtube.com/@ASMLcompany" }
    };

    const wikiMap = {
      "AAPL": "ì• í”Œ", "MSFT": "ë§ˆì´í¬ë¡œì†Œí”„íŠ¸", "NVDA": "ì—”ë¹„ë””ì•„", "GOOGL": "ì•ŒíŒŒë²³ (ê¸°ì—…)",
      "AMZN": "ì•„ë§ˆì¡´ë‹·ì»´", "META": "ë©”íƒ€ í”Œë«í¼ìŠ¤", "TSLA": "í…ŒìŠ¬ë¼", "AVGO": "ë¸Œë¡œë“œì»´",
      "COST": "ì½”ìŠ¤íŠ¸ì½”", "ASML": "ASML"
    };

    if (!symbol || !companyInfo[symbol]) {
      alert("ìœ íš¨í•˜ì§€ ì•Šì€ ì¢…ëª©ì…ë‹ˆë‹¤.");
    } else {
      const company = companyInfo[symbol];

      // ì œëª© êµ¬ì„±
      const titleArea = document.getElementById("stockTitle");
      titleArea.innerHTML = `
        <img src="${company.logo}" alt="${symbol} ë¡œê³ ">
        ${company.name} (${symbol})
        <a class="btn-link" href="${company.youtube}" target="_blank">ğŸ“º ìœ íŠœë¸Œ</a>
        <button id="memoBtn" class="btn-link" style="background:#28a745;">ğŸ“ ë©”ëª¨</button>
      `;

      // ê°€ê²© ì •ë³´
      fetch(`https://api.twelvedata.com/quote?symbol=${symbol}&apikey=${TWELVE_API_KEY}`)
        .then(res => res.json())
        .then(data => {
          if (data.code) throw new Error(data.message);
          document.getElementById("currentPrice").textContent = `${data.price ? "$" + String(data.price) : "ì¥ ì‹œì‘ ì „"}`;
          document.getElementById("prevClose").textContent = `$${data.previous_close}`;
        })
        .catch(() => {
          document.getElementById("currentPrice").textContent = "ë°ì´í„° ì—†ìŒ";
          document.getElementById("prevClose").textContent = "ë°ì´í„° ì—†ìŒ";
        });

      // ì°¨íŠ¸
      fetch(`https://api.twelvedata.com/time_series?symbol=${symbol}&interval=1h&outputsize=24&apikey=${TWELVE_API_KEY}`)
        .then(res => res.json())
        .then(data => {
          const labels = data.values.map(v => v.datetime).reverse();
          const prices = data.values.map(v => v.close).reverse();
          const ctx = document.getElementById("stockChart").getContext("2d");
          new Chart(ctx, {
            type: "line",
            data: {
              labels: labels,
              datasets: [{
                label: `${symbol} ì¢…ê°€`,
                data: prices,
                borderColor: "#007bff",
                backgroundColor: "rgba(0,123,255,0.1)",
                tension: 0.3,
                fill: true
              }]
            },
            options: {
              responsive: true,
              scales: {
                x: { ticks: { maxTicksLimit: 8 }},
                y: { title: { display: true, text: 'ê°€ê²© ($)' }}
              }
            }
          });
        })
        .catch(() => {
          document.getElementById("chartContainer").innerHTML = "<p style='color:red;'>ì°¨íŠ¸ ë¡œë”© ì‹¤íŒ¨</p>";
        });

      // ìœ„í‚¤ ì„¤ëª…
      const wikiTitle = wikiMap[symbol];
      if (wikiTitle) {
        document.getElementById("wikiLink").href = `https://ko.wikipedia.org/wiki/${encodeURIComponent(wikiTitle)}`;
        fetch(`https://ko.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(wikiTitle)}`)
          .then(res => res.json())
          .then(data => {
            document.getElementById("wikiSummary").textContent = data.extract || "ì„¤ëª…ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
          })
          .catch(() => {
            document.getElementById("wikiSummary").textContent = "ì„¤ëª… ë¡œë”© ì‹¤íŒ¨";
          });
      } else {
        document.getElementById("wikiSummary").textContent = "ì´ ì¢…ëª©ì— ëŒ€í•œ ì„¤ëª…ì€ ì—†ìŠµë‹ˆë‹¤.";
      }

      // ë‰´ìŠ¤
      fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(`https://feeds.finance.yahoo.com/rss/2.0/headline?s=${symbol}&region=US&lang=en-US`)}`)
        .then(res => res.json())
        .then(data => {
          const parser = new DOMParser();
          const xml = parser.parseFromString(data.contents, "application/xml");
          const items = Array.from(xml.querySelectorAll("item")).slice(0, 5);
          const list = document.getElementById("newsList");
          list.innerHTML = "";
          items.forEach(item => {
            const li = document.createElement("li");
            li.innerHTML = `<a href="${item.querySelector("link").textContent}" target="_blank">${item.querySelector("title").textContent}</a>`;
            list.appendChild(li);
          });
        })
        .catch(() => {
          document.getElementById("newsList").innerHTML = "<li>ë‰´ìŠ¤ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</li>";
        });

      // ë©”ëª¨ ê¸°ëŠ¥
      const memoBtn = document.getElementById("memoBtn");
      const memoBox = document.getElementById("memoBox");
      const memoTextarea = document.getElementById("memoTextarea");
      const saveMemoBtn = document.getElementById("saveMemoBtn");
      const memoSaved = document.getElementById("memoSaved");

      // ì´ˆê¸°ê°’
      const savedMemo = localStorage.getItem(`note_${symbol}`) || "";
      memoTextarea.value = savedMemo;

      memoBtn.addEventListener("click", () => {
        memoBox.style.display = memoBox.style.display === "none" ? "block" : "none";
      });

      saveMemoBtn.addEventListener("click", () => {
        localStorage.setItem(`note_${symbol}`, memoTextarea.value);
        memoSaved.style.display = "inline";
        setTimeout(() => memoSaved.style.display = "none", 2000);
      });
    }
  </script>
</body>
</html>